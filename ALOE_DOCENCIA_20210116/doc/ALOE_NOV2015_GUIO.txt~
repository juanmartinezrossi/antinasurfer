_____________________________________________________________________________________________________________

@ ALOE INFO: flexnets.upc.edu
http://flexnets.upc.edu/trac/wiki/ALOEOFDMDemo

_____________________________________________________________________________________________________________
@ Linux usefull commands
1) General. 
	ls
	ls -al
	cd ..
	cd /folder
	mkdir foldername
	rm -r foldername
	cp file1 file2
	diff file1 file2
	ps -ef 
	sudo (talk about priorities)
	grep -r "char_sequence" * (or the wished file or folder)
	chown ubuntu.ubuntu
	chmod a+rwx modulename
	sudo apt-get update

2) Check if a process is active
	pgrep -x process_name

	sudo kill -9 pid 
   	sudo pkill -9 proces_name	

3)	Edition 
	gedit

_____________________________________________________________________________________________________________
@ Install ALOE UBUNTU 14.04 64 bits
// Comment the line where have "HAVE_UHD" at file modules/dac_tx/src/dac_tx.c

// Configure kernel to allow messages buffers of 209715200 bytes
Add line: 'kernel.msgmnb=209715200' to /etc/sysctl.conf 
Add line: 'kernel.msgmax=10485760' to /etc/sysctl.conf 

and run 'sysctl -p' as root

Install required libraries
sudo apt-get update
sudo apt-get install devscripts build-essential
sudo apt-get install gawk
sudo apt-get install g++
sudo apt-get install perl

Library boost
Install via Synaptic: libboost-all-dev and libboost-dev or do sudo apt-get install libboost-all-dev
Library readline
Install from command line: sudo apt-get install libreadline6 libreadline6-dev
Library fftw3
Install library "fftw3": sudo apt-get install fftw3-dev pkg-config

Install gnuplot-qt
sudo apt-get install gnuplot-qt rlwrap

//Update Automake Tools
automake
autoconf

// Configure Makefiles
./configure LIBS='-lpthread -lboost_system'

//If not, execute
autoconf
./configure LIBS='-lpthread -lboost_system'
and check again

When "configure" success do:

make (to compile ALOE)

sudo make install (to install ALOE)


An alternative way to perform all these steps is to execute the script configureALL.sh by typing in the ALOE folder:
./configureALL.sh


_____________________________________________________________________________________________________________
@ Describe Module folder and files



_____________________________________________________________________________________________________________
@ Create New Modules
Basically copies the content of the module module_template in the folder of the new module created.
Please, follow these steps:


cd ALOE_folder
cd scripts
./create_moduleALOE1.6.sh new_module_name

//Update ALOE configure 
cd .. 
scripts/update_modules.pl

//Update Automake Tools
./configure LIBS='-lpthread -lboost_system'

//Check that the new module has been added looking for the following line from output of configure command
config.status: creating modules/YOUR_MODULE_NAME/lnx_make/Makefile

//If not, execute
autoconf
./configure LIBS='-lpthread -lboost_system'
and check again

_____________________________________________________________________________________________________________
@ Setup Real-Time



_____________________________________________________________________________________________________________
@ Debugging Tools: 

1) Valgrind: Finding Memory Leaks
valgrind --tool=memcheck program_name

Check other Valgrind tools at: http://www.cprogramming.com/debugging/valgrind.html

_____________________________________________________________________________________________________________
@ Module folders

All modules are located under /modules folder. The module folder estructure is the following:

/modules/moduleName
					/aloe
					/debug_make
					/interfaces
					/lnx_make
					/matlab
					/src
					/standalone


You must work only under /src folder for each specific module. 

_____________________________________________________________________________________________________________
@ Show Standalone debugging 
Working folder: modulename/debug_make

# Compilation: 
1) Open a terminal and go to modulename/debug_make/ folder.
2) Execute "make" command.
3) Execute compiled program: "./modulename list_of_options


"./modulename -h" to see the execution options 
printf("o STANDALONE EXECUTION ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\n");
		printf("o Two alternatives: a)Autogenerated input data, b)Load input file.                   o\n");
		printf("o Options: -p:  plot input/output                                                    o\n");
		printf("o          -it: input text file according module input data type format.             o\n");
		printf("o          -ib: input binari file according module input data type format.           o\n");
		printf("o          -ot: output text file according module output data type format.           o\n");
		printf("o          -ob: output binari data file according module output data type format.    o\n");
		printf("o          block_length=XX: Number of samples sent to input each time slot           o\n");
		printf("o          run_times=XX: Number of time slot executed                                o\n");
		printf("o          plot_mode=XX: plotting options                                            o\n");
		printf("o Autogenerated input data example:                                                  o\n");
		printf("o     ./module_name -p block_length=10 run_times=2                                   o\n");
		printf("o Load input data example:                                                           o\n");
		printf("o     ./module_name -p -ib ../../../LTEcaptures/aloe.dat block_length=10 run_times=1 o\n");
		printf("o Plotting Options  (XX=IN or XX=OUT)                                                o\n");
		printf("o          plot_modeXX=C1WLS: Real-Imaginary, 1 Window, Linear, Single frame         o\n");
		printf("o          plot_modeXX=C2WLS: Real + Imaginary (2 Windows); Linear, Single frame.    o\n");
		printf("o          plot_modeXX=CFFTMF: Complex, FFT, Multiple Frames.                        o\n");
		printf("o          plot_modeXX=CFFTSF: Complex, FFT, Magnitude & Argument, Single Frame.     o\n");
		printf("o          plot_modeXX=CCSF: Complex, Constellation. Single Frame.                   o\n");
		printf("o          plot_modeXX=DEFAULT: User defined at src/graph_mode.h                     o\n");
		printf("o Plot example with autogenerated data:                                              o\n");
		printf("o     ./module_name -p block_length=10 run_times=2 plot_mode=CFFTSF                  o\n");
		printf("oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo\n");



5) Examples: data_source module scripts
    a) data_source_C1WLS.sh
   	b) data_source_C2WLS.sh
	c) data_source_CCSF.sh
	d) data_source_CFFTMF.sh
	e) data_source_CFFTSF.sh
	
	To execute one of them put the command "./data_source_C1WLS.sh"

_____________________________________________________________________________________________________________
@ Create new waveforms

_____________________________________________________________________________________________________________
@ Waveform.Modules parameters

_____________________________________________________________________________________________________________
@ Global Execution: Waveforms

1) Check no zombi process: pgrep -x runcf (name of the process) and sudo pkill -9 runcf (if needed)
2) sudo make install (put everything at the right place)
3) runcf -f (Cleaning resources associated to lock: /tmp/phdefault.lock. Force deletetion of previous session) 
4) runcf -h (shows the options)


To execute an app follow next steps:
1) Go to app folder: cd /APPs/CLASSTools/appname/ 
2) Execute runcf -c platformName.conf

··············································································
The generic usage is as follow:

New Usage!!!
	runcf -c [platform_cfg_file] --debug -v [--daemon] [-o output_log]
	 -c [platform_config_file]: Platform configuration file. 
				Define also the scheduling and interfacing files. Typically "shceduling.conf" and "xitf.conf" 
	 -f Force deletetion of previous session
	 --daemon: Run as a daemon. You should select log file for each daemon in platform config file.
	 -o [output_log]: Redirect hwapi stdout to a file, useful when running as daemon.
	 -t [num_processors] number_of_mac_operations: Run number_of_mac_operations and compute MACPS performance.
	 --valgrind: Enable valgrind (setup at scheduling config file).
	 --debug: Run in debug mode.
	 --trace: Print timing info to kernel trace.
	 -v: Run in verbose mode.
..............................................................................

The following text should appear.

linux; GNU C++ version 4.8.2; Boost_105700; UHD_003.008.003-137-g2f760ac0

O============================================================================================O
Initiate Parsing of Platform Config Files
Platform_file(): platformJACK.conf
Scheduling_file(): scheduling.conf
Interfacing_file(): xitf.conf
O============================================================================================O
KERNEL:	Using working path: /
KERNEL:	Local Computing Capacity: 280.0 MOP/s 2 cores
KERNEL:	Internal Bandwidth: 100000.0 MBps
Configure DAC
KERNEL:	Time slot duration set to 21333 usec
SOUND_CARD_TX: outputFreq=48000.0
SOUND_CARD_TX: outputRFFreq=0.0
SOUND_CARD_TX: NsamplesOut=1024
SOUND_CARD_TX: tx_gain=1.0
SOUND_CARD_TX: tx_bw=24000.0
SOUND_CARD_RX: inputFreq=48000.0
SOUND_CARD_RX: inputRFFreq=0.0
SOUND_CARD_RX: NsamplesIn=1024
SOUND_CARD_RX: rx_gain=1.0
SOUND_CARD_RX: rx_bw=24000.0
SNDCARD_INIT
SYNCMS:	Init ok
F-END:	I'm a local master.
F-END:	Init ok
HWMAN:	Init ok
SWMAN:	Init ok
EXEC:	Init ok

O__SOUND CARD PROPERLY INITIALLIZED___________________________________________________________________ 
O  NsamplesIn=1024, NsamplesOut=1024                                                                  O 
O  DAC buffer size = 1024, DAC sample rate: 48000                                                     O 
O  WARNING; Required TimeSlot=21333 (us). Please, setup accordingly at hw_api/lnx/cfg/platform.conf   O 
O__SOUND CARD PROPERLY INITIALLIZED___________________________________________________________________O 
BRIDGE:	External input itf 0x80 configured fd 5.
BRIDGE:	Init ok
STATS:	Init ok
STMAN:	Init ok
SWLOAD:	Init ok


======================================
-= ALOE Command Manager =-
======================================


Enter Commands.
Type 'help' for available commands.

runph$: HWMAN:	Add processor: 
	New CPU: PE 0x2, 5.973 MOPTS, BW 2133.3 MBPTS, 2 cores, TS=21333 us
	-- Available computing resources (C vector in KOPTS) --
	5973		5973		

runph$: 


If not, please, press return key.

It is important to verify that "__SOUND CARD PROPERLY INITIALLIZED" has been appeared, otherwise 
audio board can not be used.


Several scripts would help to simplfy the starting, stopping, compiling and system cleaning process.
In APPs/CLASSTools/appname/ folder execute:

./runcf_start.sh		: Executes the appname app in normal priority.
./runcf_startRT.sh		: Executes the appname app in root priority (High priority). 
./stop_runcf.sh			: Stops and cleans the previous execution.
./make_installALL.sh	: Compiles averything.
./make_installNEW.sh	: Compiles only last changes.

After each execution it is recommended to make a ./stop_runcf.sh 



3) On prompt (runph$) put "help"
runph$: help

The following text should appear showing the list of available options:

List of options!!!
	help		Display this text.
	load		Load application.	Usage: load app_name.
	run			Run application.	Usage: run app_name q-factor.
	init		Init application.	Usage: init app_name.
	pause		Pause application.	Usage: pause app_name.
	step		Step application.	Usage: step app_name.
	stop		Stop application.	Usage: stop app_name.
	statlist	List statistics.	Usage: statlist app_name [obj_name].
	statset		Modify statistic.	Usage: statset app_name obj_name stat_name new_value.
	statget		Get a statistic value.	Usage: statget app_name obj_name stat_name.
	statreport	Start/stop report.	Usage: statreport start/stop app_name obj_name stat_name window_len period.
	applist		List applications.	Usage: applist.
	pelist		List PE in platform.	Usage: pelist.
	execreport	Start/Stop EXEC reps. 	Usage: execreport app_name start/stop.
	execlog		Start/Stop EXEC logs. 	Usage: execlog app_name start/stop.
	execinfo	Exec information. 	Usage execinfo app_name [obj_name].
	exit		Exit this program.



4) Then proceed with:
runph$: load appname
runph$: init appname
runph$: run appname
And use ctrl-C to exit and cancel the app execution.


















XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXx



5) After execute runcf
Wait until:
O__SOUND CARD PROPERLY INITIALLIZED___________________________________________________________________ 
O  NsamplesIn=1024, NsamplesOut=1024                                                                  O 
O  DAC buffer size = 1024, DAC sample rate: 48000                                                     O 
O  WARNING; Required TimeSlot=21333 (us). Please, setup accordingly at hw_api/lnx/cfg/platform.conf   O 
O__SOUND CARD PROPERLY INITIALLIZED___________________________________________________________________O 

Then proceed with:
5.1) load appname
5.2) init appname
5.3) run appname
ctrl-C to exit


6) Executing a complex waveform: ofdm128.app
	runcf 
	load ofdm128
	init ofdm128
	run ofdm128

	execinfo ofdm128


7) Plotting Generated Signal: Waveform "source_plot.app"
runcf
load source_plot
init source_plot
run source_plot


8) Transmiting/Receiving Signal
8.1) Test the transmitter. soundcard_TXV0.app 
8.2) Test transmitter and Receviver: souncard_TXRXV0.app
8.3) Test minimum TX chain: souncard_testV1.app
	 data_source->dac_TXRX. Sent a tone. We can modify tone via changing parameters in statman/souncard_testV1/data_source.params
8.4) Test minimum RX chain: soundRX_plot.app
	 dac_RXTX->sink_plot


_____________________________________________________________________________________________________________
@ Introduce JACK
Look at INSTALL_JACK_SERVER.txt document in JACK_UTILS folder

_____________________________________________________________________________________________________________
@ Speakers 1W
_____________________________________________________________________________________________________________
@ Octave


_____________________________________________________________________________________________________________
@ Eclipse
To incorporate a module into ECLIPSE environment follow:

File->Import->General: Existing Projects into Workspace -> Browse-> ALOE_folder/modules/modulename/ -> Finish


_____________________________________________________________________________________________________________
@ NEW EXECUTION FOR NOV15 version
Go to APP folder you wish to execute:
cd APPs/TOPIC/appname/

To execute do:
runcf -c hwplatform/platform.conf		# Please. check the configuration details of platform.conf
										# You must modify the setup according your hardware needs

Or use the scripts.
Normal User
./runcf_start.sh		To execute as normal user
						In case of using JACK remember to execute jack server as normal user.
						In JACK_UTILS/SERVER folder do: ./start_jack_server.sh

Or as privileged User (real-time benefits)
./runcf_startRT.sh 		To execute as privileged user. 
						In case of using JACK remember to execute jack server as root.
						In JACK_UTILS/SERVER folder do: sudo ./start_jack_server.sh

And in the prompt:
load appname (without app extension)
init appname
run appname

and use:
./stop_runcf.sh 		To clean previous executions. 
We recommend to execute "stop_runcf.sh" after each execution.

Remember to modify the scripts according your platform.conf file and also the scripts if you modify the 
platform.conf file name.
_____________________________________________________________________________________________________________
@AUTO_LOAD
1) //Autoload "benchmark2M" waveform
	1.1)	file "cmdman_console/cmdman.c" modified. Changes at "AGB NOV15"
	1.2)	Comment with // line 71: #define AUTO_LOAD_APP for Auto Load
	1.3)	Uncomment line 71: #define AUTO_LOAD_APP for Normal APP load
	1.4)    Modify app name, at line 74 of cmdman.c file, for autolaunch a different to benchmark2M app

_____________________________________________________________________________________________________________
OLD Usage!!! from ALOE root folder:

	runcf -r [repository_path] -c [platform_cfg_file] -i [xitf_cfg_file] --debug -v [--daemon] [-o output_log]
	 -r [repository_path]: Path for file resources (for manager daemons)
	 -c [platform_config_file]: Platform configuration file
	 -f Force deletetion of previous session
	 --daemon: Run as a daemon. You should select log file for each daemon in platform config file.
	 -o [output_log]: Redirect hwapi stdout to a file, useful when running as daemon.
	 -t [num_processors] number_of_mac_operations: Run number_of_mac_operations and compute MACPS performance.
	 --valgrind: Enable valgrind (setup at scheduling config file).
	 --debug: Run in debug mode.
	 --trace: Print timing info to kernel trace.
	 -v: Run in verbose mode.
_____________________________________________________________________________________________________________
	








